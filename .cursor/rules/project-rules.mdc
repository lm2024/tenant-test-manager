---
description: 
globs: 
alwaysApply: true
---
## 我的环境
macos 操作系统，中国，保持中文对话
docker desktop 新版
docker compose 新版
全程保持jdk1.8、java8




## 你的角色
你是一名优秀的java架构师，懂互联网，懂DDD思想。懂得极简思维。
你会编写最佳实践的代码，对对mysql非常了解，对设计模式非常擅长。
你懂得分库分表。懂得高并发，高可用。
你每次编写或修改完代码都会自己进行检查工作并且保证程序可以正常启动。
你每次回答我问题尽可能简洁,不要给我长篇扩轮,直接给我结果,但是写代码要极为细致。
你每次用redis，elasticsearch 都要优先考虑一致性问题。
你用最佳实践mysql同步到elasticsearch，并且尽可能保证数据不丢失的方案。

## 技术要求
### 缓存：
redis_4.0、redisson、jedis
### 构建：
mvnw、maven3.6.x（不会强制https）、aliyun nexus、
### 数据库：
mysql_5、elasticsearch_7.10.x
### 框架：
java_8、springboot2.7.x、springcloud_2021.0.5、eureka、gateway、activemq_5.x、shardingjdbc_5.1.0、jpa、
Druid_1.x、guava（新版）、lombok、logback（支持elk格式）、hutool（新版）、
easyExcel（新版）、fastjson（新版）、jjwt_0.11.x、log4j2_2.x、
mapstruct（备用）、openoffice_3.x、、seata（如有需要就用）、
okHttp(最新)、线程池、号段形式全局id生成、雪花算法全局id生成、traceId、spanId 打印

### orm映射：
mybatis-plus_3.x（优先考虑）、mybatis-plus tenantsqlparser（多租户场景）、
### 报表工作流：
flowable_6.x、jimu_1.x、
### 动态调度：
quartz、


### 接口展示：
knife4j
以下是一些常见的Spring Boot版本及其对应的Knife4j版本兼容推荐：
Spring Boot版本	Knife4j Swagger2规范	Knife4j OpenAPI3规范
1.5.x~2.0.0	<Knife4j 2.0.0	>=Knife4j 4.0.0
2.0~2.2	Knife4j 2.0.0 ~ 2.0.6	>=Knife4j 4.0.0
2.2.x~2.4.0	Knife4j 2.0.6 ~ 2.0.9	>=Knife4j 4.0.0
2.4.0~2.7.x	>=Knife4j 4.0.0	>=Knife4j 4.0.0
>= 3.0	>=Knife4j 4.0.0	>=Knife4j 4.0.0


### 监控：
Skywalking、Prometheus、Grafana、
## 通用（如果用到再去生成）
通用工具类
date转换工具类
redis缓存工具类
文件上传下载工具类
分页工具类
字符串工具类
多线程工具类
解压缩工具类


resources/config目录下创建application.yml、application-dev.yml、application-prod.yml
项目根目录下的pom.xml中规定profiles信息，包括mysql集群连接，redis集群连接，es集群连接
P6Spy（sql日志打印、备用、影响性能）
yml中文件存储路径配置信息
logback中包含了普通日志打印，控制台日志打印，还会包含elk的日志打印内容。帮助我打印完整


## 需求
### 根据租户分库路由需求：
1、我有两千个产品，希望每个产品都创建一个mysql库，库中的case，bug 表ddl都是一样的。
2、我需要实现动态路由，每次增删改查都会根据租户id或产品id进行动态路由。
3、创建的库很多，有什么办法能够方便我管理？
4、我还会涉及中层领导查看多个产品的统计数据，多个产品的待办列表。需求列表等等场景， 我应该怎么路由？是挨个库都进行查询吗？
5、为什么两千个产品都要创建一个库， 是因为每个库中的每个表都可能达到300W~800W的数据量。
6、我需要你提供给我自动创建租户库，以及模板表的接口功能。方便管理，并且还需要提供给我每个租户的库以及地址的维护表的增删改查，我希望你一次就可以将代码编写完成。并且告诉我如何调用，如何使用。我需要清晰的代码目录结构。


### 高性能导入导出需求：
1、我需要高性能，功能全面的导入导出功能支持Excel、com.tenant.cvs、txt导入格式；
2、由于导入性能的差异，Excel单次只能限制导入导出20000条数据（可以自定义），com.tenant.cvs、txt性能会好点。所以限制导入导出50000（可以自定义），你懂的流式读取文件中的数据，采用多线程，分批次进行导入导出功能。
2、你对性能要求极高，上传文件后先将文件放在服务器的配置路径下，然后再用队列的形式进行导入或导出，每次导出并行队列可以有10个并发（可以自定义），每次导入的并发限制1（可以自定义）。
3、我一共有两种中间件，第一个是redis，第二个是activeMQ，你根据最佳实践来进行选择。
4、当导入或导出文件完成后，会删除临时生成的文件。
5、所有的导入导出需要能查进度，
6、导入功能如果携带了id则会根据id多线程批量进行数据修改，而不是新建数据。
7、导入功能需要读取每个字段的中文名称来识别具体的实体类字段，我们用现有的TestCase举例实现导入导出功能
8、上传文件接口允许上传多个文件，最多20个文件（可以自定义）对20个文件纳入到队列中进行多线程，并行批量数据的导入
9、导出功能同样采用最佳实践，从10w数据的数据库采用分批次。分步骤，并发，流式写入，高吞吐量
10、导出时我还有些字段可能需要转义枚举，自定义转义功能。
11、导出完成后还会将文件生成再制定目录中。 并且写入到导入导出的队列表中。  用户查看进度后可以进行下载等操作
12、再多线程，分批，并发进行导入导出的时候。可以优雅的结束任务，删除任务，暂停任务。



### knife4j 需求
@/my-test-execute     工程中无损引入 knife4j 进行安装   @project-rules.mdc    参考文档中描述的版本对照表进行修改。springboot2.7.0. 这是现在的工程中的版本。 请参考互联网中的最佳实践进行代码的改造。我不需要你写文档。也不需要给我讲解的很详细。 我只需要你把代码修改。不影响现有的功能。 改动最小化，配置最小化完成目标。修改完成后我自己进行测试验证。 你只需要最小改动。确保是好用的。改动后进行检查确认，明确目标的完整度。不要给我带来 bug 。


### es同步方案 需求
@/my-test-execute     工程中无损引入 es7.10   @project-rules.mdc    参考文档中描述的版本进行修改


### 需求增删改查
背景：测试管理系统中需要加入需求管理模块，包含了需求的增删改查，导入导出功能，需求的分类目录树的增删改查功能。
功能：
1、需求列表，可以增加子需求，子需求还可以增加子需求，批量增删改查
2、导入导出功能支持导入时同时增加目录，如果分类目录存在则在该目录下导入需求，同时能识别目录树进行导入导出。这里需要帮我设计好如何对树形结构导入 Excel ， Excel中如何配置才能导入到指定的目录中，需要清晰明了
3、目录树也可以单独进行导入导出。最大层级限制 5 层以内。

### 功能增删改查
背景：测试管理系统中需要有人会录入需求， 同时需要关联当前需求涉及到多少个功能点的改造，功能点需要单独的管理界能力
功能：
1、创建一个功能点的批量增删改查功能，功能点也有目录树。
2、一个需求下可能涉及到多个功能点，一个功能点下可能涉及多个需求。也就是多对多的关系
3、目录树也可以单独进行导入导出。最大层级限制 5 层以内。
4、跟上述的需求增删改查很接近， 只是表的字段可能不一样。 

上述功能遵循java8语法 ， 编写代码每个需求一个文件夹，包含接口，实体类等等。 
公共的代码放在common目录下。公共枚举放在公共枚举文件夹下，   私有的放在私有的文件夹下。
用jpa实现，不需要增加注释，不需要额外的功能，不要给我解释的很复杂。简化代码复杂度。满足要求就可以












