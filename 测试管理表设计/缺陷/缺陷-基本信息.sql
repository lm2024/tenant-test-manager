https://www.tapd.cn/api/aggregation/workitem_aggregation/get_info
Request Method
POST


{"workspace_id":"60498179","entity_id":"1160498179001000009","entity_type":"bug","api_controller_prefix":"","enable_description":"true","is_detail":1,"blacklist_fields":["workspace_configs"],"identifier":"app_for_editor,app_for_obj_more,app_for_obj_dialog_dropdown,app_for_obj_detail_panel,app_for_obj_detail_bottom_card,app_for_obj_attachment,app_for_obj_copy_link,app_for_obj_additional_panel","installed_app_entity":{"obj_id":"1160498179001000009","obj_type":"bug","obj_name":"【示例】缺陷2"},"has_edit_rule_fields":[],"is_archived":0,"is_assistant_exec_log":1,"dsc_token":"B14PcWsEU6IsFDYQ"}




{
    "data": {
        "get_info_ret": {
            "data": {
                "Bug": {
                    "id": "1160498179001000009",
                    "secret_root_id": "0",
                    "sid": "0",
                    "project_id": "60498179",
                    "parent_id": "",
                    "title": "\u3010\u793a\u4f8b\u3011\u7f3a\u96772",
                    "description": "\u003Cp\u003Esadf\u0026nbsp;\u003C\/p\u003E\u003Cp\u003E\u003Cbr  \/\u003E\u003C\/p\u003E\u003Cp\u003Esdf\u0026nbsp;\u003C\/p\u003E\u003Cp\u003E\u003Cbr  \/\u003E\u003C\/p\u003E\u003Cp\u003E\u003Cbr  \/\u003E\u003C\/p\u003E\u003Cp\u003Esadf\u003C\/p\u003E\u003Cp\u003E\u003Cbr  \/\u003E\u003C\/p\u003E\u003Cp\u003E\u003Cbr  \/\u003E\u003C\/p\u003E\u003Cp\u003Esdf\u003C\/p\u003E\u003Cp\u003E\u003Cbr  \/\u003E\u003C\/p\u003E\u003Cp\u003Es\u003C\/p\u003E\u003Cp\u003Edf\u003C\/p\u003E\u003Cp\u003E\u003Cbr  \/\u003E\u003C\/p\u003E\u003Cp\u003E\u003Cbr  \/\u003E\u003C\/p\u003E\u003Cp\u003Esdf\u003C\/p\u003E\u003Cp\u003E\u003Cbr  \/\u003E\u003C\/p\u003E\u003Cp\u003Esd\u003C\/p\u003E",
                    "markdown_description": "",
                    "description_type": "1",
                    "module": "",
                    "milestone": "",
                    "reporter": "TAPD",
                    "deadline": "",
                    "created": "2025-05-30 11:17:18",
                    "resolved": "",
                    "closed": "",
                    "modified": "2025-06-12 16:55:08",
                    "lastmodify": "\u672a\u547d\u540d\u5c0f\u7a0b\u5e8f",
                    "auditer": "",
                    "de": "\u672a\u547d\u540d\u5c0f\u7a0b\u5e8f;",
                    "te": "",
                    "confirmer": "",
                    "current_owner": "\u672a\u547d\u540d\u5c0f\u7a0b\u5e8f;",
                    "participator": "",
                    "closer": "",
                    "status": "in_progress",
                    "resolution": "",
                    "priority": "medium",
                    "severity": "normal",
                    "platform": "",
                    "os": "",
                    "testmode": "",
                    "testtype": "",
                    "testphase": "",
                    "source": "",
                    "frequency": "",
                    "cc": "",
                    "estimate": "",
                    "flows": "|in_progress",
                    "version_report": "\u7248\u672c1",
                    "version_test": "",
                    "version_fix": "",
                    "version_close": "",
                    "delayed": "0",
                    "custom_field_one": "",
                    "custom_field_two": "",
                    "custom_field_three": "",
                    "custom_field_four": "",
                    "custom_field_five": "",
                    "regression_number": "0",
                    "issue_id": "",
                    "support_id": "",
                    "support_forum_id": "",
                    "created_from": "",
                    "baseline_find": "",
                    "baseline_join": "",
                    "baseline_close": "",
                    "ticket_id": "",
                    "story_id": "",
                    "baseline_test": "",
                    "originphase": "",
                    "sourcephase": "",
                    "bugtype": "",
                    "feature": "",
                    "in_progress_time": "2025-06-12 16:55:08",
                    "verify_time": "",
                    "reject_time": "",
                    "reopen_time": "",
                    "audit_time": "",
                    "suspend_time": "",
                    "assigned_time": "",
                    "iteration_id": "0",
                    "custom_field_6": "",
                    "custom_field_7": "",
                    "custom_field_8": "",
                    "custom_plan_field_1": "0",
                    "custom_plan_field_2": "0",
                    "custom_plan_field_3": "0",
                    "custom_plan_field_4": "0",
                    "template_id": "1160498179001000029",
                    "begin": "",
                    "due": "",
                    "release_id": "",
                    "fixer": "",
                    "follower": "",
                    "sync_type": "",
                    "label": "",
                    "effort": "",
                    "effort_completed": "0",
                    "exceed": "0",
                    "remain": "0",
                    "progress": "0",
                    "size": "",
                    "custom_field_101": "",
                    "custom_field_102": "",
                    "custom_field_103": "",
                    "custom_field_104": "",
                    "custom_field_105": "",
                    "ID": "1000009",
                    "is_followed": "0",
                    "iteration_name": "",
                    "story_name": "",
                    "release_name": "",
                    "template_name": "\u7cfb\u7edf\u9ed8\u8ba4\u6a21\u677f",
                    "status_alias": "\u63a5\u53d7\/\u5904\u7406",
                    "workspace_name": "\u5927\u578b\u56e2\u961f\u654f\u6377\u7814\u53d1",
                    "enable_quickly_transfer": "0"
                },
                "BugStoryRelation": [],
                "copy_info": {
                    "url": "https:\/\/www.tapd.cn\/tapd_fe\/60498179\/bug\/detail\/1160498179001000009",
                    "convert_url": "",
                    "commit_keyword": "--bug=1000009 --user=\u672a\u547d\u540d\u5c0f\u7a0b\u5e8f {#name#} https:\/\/www.tapd.cn\/60498179\/s\/1000094",
                    "copy_id": "1000009"
                },
                "show_fields_info": {
                    "show_fields_memo": {
                        "version_report": "",
                        "module": "",
                        "priority": "",
                        "severity": "",
                        "current_owner": "",
                        "reporter": "",
                        "created": "",
                        "id": "",
                        "custom_field_one": "abc"
                    },
                    "show_fields": [
                        {
                            "name": "version_report",
                            "label": "\u53d1\u73b0\u7248\u672c",
                            "pure_options": [],
                            "html_type": "select",
                            "setting_url": "https:\/\/www.tapd.cn\/60498179\/versions",
                            "color_options": [],
                            "enable_color": "0",
                            "memo": ""
                        },
                        {
                            "name": "module",
                            "label": "\u6a21\u5757",
                            "pure_options": [],
                            "html_type": "select",
                            "setting_url": "https:\/\/www.tapd.cn\/60498179\/modules\/index",
                            "color_options": [],
                            "enable_color": "0",
                            "memo": ""
                        },
                        {
                            "name": "priority",
                            "label": "\u4f18\u5148\u7ea7",
                            "color_options": [
                                {
                                    "value": "urgent",
                                    "label": "\u7d27\u6025",
                                    "color": "#FF6770"
                                },
                                {
                                    "value": "high",
                                    "label": "\u9ad8",
                                    "color": "#FF6770"
                                },
                                {
                                    "value": "medium",
                                    "label": "\u4e2d",
                                    "color": "#28AB80"
                                },
                                {
                                    "value": "low",
                                    "label": "\u4f4e",
                                    "color": "#7C8597"
                                },
                                {
                                    "value": "insignificant",
                                    "label": "\u65e0\u5173\u7d27\u8981",
                                    "color": "#7C8597"
                                }
                            ],
                            "pure_options": [],
                            "html_type": "select",
                            "setting_url": "",
                            "enable_color": "0",
                            "memo": ""
                        },
                        {
                            "name": "severity",
                            "label": "\u4e25\u91cd\u7a0b\u5ea6",
                            "pure_options": [],
                            "html_type": "select",
                            "setting_url": "",
                            "color_options": [],
                            "enable_color": "0",
                            "memo": ""
                        },
                        {
                            "name": "current_owner",
                            "label": "\u5904\u7406\u4eba",
                            "pure_options": [],
                            "html_type": "user_chooser",
                            "setting_url": "",
                            "memo": ""
                        },
                        {
                            "name": "reporter",
                            "label": "\u521b\u5efa\u4eba",
                            "pure_options": [],
                            "html_type": "user_chooser",
                            "setting_url": "",
                            "memo": ""
                        },
                        {
                            "name": "created",
                            "label": "\u521b\u5efa\u65f6\u95f4",
                            "pure_options": [],
                            "html_type": "datetime",
                            "setting_url": "",
                            "memo": ""
                        },
                        {
                            "name": "id",
                            "label": "ID",
                            "pure_options": [],
                            "html_type": "input",
                            "setting_url": "",
                            "memo": ""
                        },
                        {
                            "name": "custom_field_one",
                            "label": "abc",
                            "pure_options": [],
                            "html_type": "text",
                            "setting_url": "",
                            "memo": "abc"
                        }
                    ],
                    "open_fields": [],
                    "editable_fields": {
                        "version_report": {
                            "editabled_type": "tselect",
                            "system_name": "version_report",
                            "required": "",
                            "options": [
                                {
                                    "value": "\u7248\u672c1",
                                    "label": "\u7248\u672c1"
                                }
                            ],
                            "tree_options": []
                        },
                        "module": {
                            "editabled_type": "tselect",
                            "system_name": "module",
                            "required": "",
                            "options": [
                                {
                                    "value": "\u6a21\u57571",
                                    "label": "\u6a21\u57571"
                                }
                            ],
                            "tree_options": []
                        },
                        "priority": {
                            "editabled_type": "tselect",
                            "system_name": "priority",
                            "required": "",
                            "options": [
                                {
                                    "value": "urgent",
                                    "label": "\u7d27\u6025"
                                },
                                {
                                    "value": "high",
                                    "label": "\u9ad8"
                                },
                                {
                                    "value": "medium",
                                    "label": "\u4e2d"
                                },
                                {
                                    "value": "low",
                                    "label": "\u4f4e"
                                },
                                {
                                    "value": "insignificant",
                                    "label": "\u65e0\u5173\u7d27\u8981"
                                }
                            ],
                            "tree_options": [],
                            "color_options": [
                                {
                                    "value": "urgent",
                                    "label": "\u7d27\u6025",
                                    "color": "#FF6770"
                                },
                                {
                                    "value": "high",
                                    "label": "\u9ad8",
                                    "color": "#FF6770"
                                },
                                {
                                    "value": "medium",
                                    "label": "\u4e2d",
                                    "color": "#28AB80"
                                },
                                {
                                    "value": "low",
                                    "label": "\u4f4e",
                                    "color": "#7C8597"
                                },
                                {
                                    "value": "insignificant",
                                    "label": "\u65e0\u5173\u7d27\u8981",
                                    "color": "#7C8597"
                                }
                            ]
                        },
                        "severity": {
                            "editabled_type": "tselect",
                            "system_name": "severity",
                            "required": "",
                            "options": [
                                {
                                    "value": "\u81f4\u547d",
                                    "label": "\u81f4\u547d"
                                },
                                {
                                    "value": "\u4e25\u91cd",
                                    "label": "\u4e25\u91cd"
                                },
                                {
                                    "value": "\u4e00\u822c",
                                    "label": "\u4e00\u822c"
                                },
                                {
                                    "value": "\u63d0\u793a",
                                    "label": "\u63d0\u793a"
                                },
                                {
                                    "value": "\u5efa\u8bae",
                                    "label": "\u5efa\u8bae"
                                }
                            ],
                            "tree_options": []
                        },
                        "current_owner": {
                            "editabled_type": "pinyinuserchooser",
                            "system_name": "current_owner",
                            "required": "",
                            "options": [
                                {
                                    "value": "data_source_url",
                                    "label": "https:\/\/www.tapd.cn\/"
                                },
                                {
                                    "value": "data_source_url_params",
                                    "label": "?workspace_id=60498179\u0026r=3"
                                }
                            ],
                            "tree_options": []
                        },
                        "custom_field_one": {
                            "editabled_type": "text",
                            "system_name": "custom_field_one",
                            "required": "",
                            "options": {
                                "": ""
                            },
                            "tree_options": [],
                            "label": "abc"
                        }
                    }
                },
                "is_followed": "0",
                "socket_login_data": {
                    "socket_path": "https:\/\/spider.tapd.cn\/workitems",
                    "login_data": {
                        "user_nick": "\u672a\u547d\u540d\u5c0f\u7a0b\u5e8f::328519613",
                        "workspace_id": "60498179",
                        "timespan": "1749718574.9494866",
                        "data_id": "workitems",
                        "token": "c1ea348e500cd3f0b6197e7a74adbd9848adc681"
                    },
                    "room_ids": [
                        "WORKITEMS_CHANGE_bug_detail_1160498179001000009"
                    ],
                    "socket_id": "60498179",
                    "need_disconnect": "1"
                },
                "is_limited_user": "",
                "comment_list": {
                    "count": "0",
                    "total_count": "0",
                    "comments": [],
                    "page_size": "10",
                    "current_page": "1"
                },
                "attachment_list": {
                    "prviewable_type": [
                        "et",
                        "ett",
                        "wps",
                        "wpt",
                        "doc",
                        "docx",
                        "xls",
                        "xlsx",
                        "png",
                        "bmp",
                        "gif",
                        "jpg",
                        "jpeg",
                        "txt",
                        "pdf",
                        "html",
                        "xml",
                        "htm",
                        "log"
                    ],
                    "attachments": [],
                    "is_enabled_document": "1",
                    "download_authority": "1",
                    "delete_authority": "1",
                    "edit_authority": "1",
                    "document_download_authority": "1",
                    "view_document_authority": "1",
                    "edit_document_authority": "1",
                    "delete_document_authority": "1",
                    "can_export_mindmap_pic": "",
                    "max_file_upload_size": "157286400",
                    "open_app_attachments": [],
                    "attachment_sort": [],
                    "permission_map": {
                        "60498179": {
                            "is_enabled_document": "1",
                            "download_authority": "1",
                            "delete_authority": "1",
                            "edit_authority": "1",
                            "document_download_authority": "1",
                            "view_document_authority": "1",
                            "edit_document_authority": "1",
                            "delete_document_authority": "1",
                            "can_export_mindmap_pic": "",
                            "max_file_upload_size": "157286400"
                        }
                    }
                },
                "file_list": [],
                "file_field_list": {
                    "60498179": []
                }
            },
            "meta": {
                "code": "0",
                "message": "success"
            },
            "timestamp": "1749718574"
        },
        "workspace": {
            "switches": {
                "sw_story_iteration": true,
                "sw_iteration": 1,
                "sw_story": 1,
                "sw_bug": 1,
                "sw_task": 0,
                "sw_measurement": 1,
                "sw_release": 0,
                "sw_launchform": 1,
                "sw_story_sourcefile": 0,
                "sw_story_category": 1,
                "sw_enable_bug_relate_story": 1,
                "sw_enable_support_platform": false,
                "sw_enable_external": 1,
                "sw_codereview": 1,
                "sw_sourcecode": 1,
                "sw_enable_mail_summarized": 0,
                "sw_totest_url": false,
                "sw_wiki": 1,
                "sw_tcase": 1,
                "sw_testplan": 1,
                "sw_feedback": 1,
                "sw_twitter": 0,
                "sw_discuss": 0,
                "sw_enabled_bug_workflow_config": false,
                "sw_file": 0,
                "sw_enable_external_wiki": 0,
                "sw_enable_external_bug": 1,
                "sw_enable_external_tobject": 0,
                "sw_document": 1,
                "sw_enable_external_document": 1,
                "sw_report": 1,
                "sw_gantt": 1,
                "sw_svn": 1,
                "sw_git": 0,
                "sw_enable_secret_story": 1,
                "sw_board": 0,
                "sw_gitlab_source": 0,
                "sw_github_source": 0,
                "sw_tgit_source": 1,
                "sw_svn_source": 0,
                "sw_p4_source": 0,
                "sw_jenkins": 0,
                "sw_dashboard": 0,
                "sw_delivery_app": 0,
                "sw_milestone": 0,
                "sw_app_checklist": 0,
                "sw_stat": 1,
                "sw_mobile_fast_transfer_story_status": 0,
                "sw_mobile_fast_transfer_bug_status": 0,
                "sw_roadmap": 0,
                "sw_pro_dashboard": 1,
                "sw_team_calendar": 0,
                "sw_testx": 1
            },
            "config": {
                "enable_multi_linkage_fields": "false"
            }
        }
    },
    "meta": {
        "code": 0,
        "message": "success"
    },
    "timestamp": 1749718574
}


这是一个协作系统的缺陷详情返回的结果。   根据返回结果分析， 我应该怎么建表 ， 如何关联


















-- Bugs 表（缺陷信息）
CREATE TABLE bugs (
    id VARCHAR(36) PRIMARY KEY COMMENT '缺陷唯一标识（UUID 或业务ID）',
    secret_root_id VARCHAR(36) NOT NULL DEFAULT '0' COMMENT '根ID（默认0）',
    sid VARCHAR(36) NOT NULL DEFAULT '0' COMMENT '会话ID（默认0）',
    project_id VARCHAR(36) NOT NULL COMMENT '关联项目ID',
    parent_id VARCHAR(36) COMMENT '父缺陷ID（可为空）',
    title TEXT NOT NULL COMMENT '缺陷标题（HTML实体编码）',
    description TEXT COMMENT '描述内容（HTML格式）',
    markdown_description TEXT COMMENT 'Markdown格式描述',
    description_type VARCHAR(10) COMMENT '描述类型（1: HTML, 2: Markdown）',
    module VARCHAR(255) COMMENT '模块',
    milestone VARCHAR(255) COMMENT '里程碑',
    reporter VARCHAR(255) NOT NULL COMMENT '报告人',
    deadline DATETIME COMMENT '截止时间',
    created DATETIME NOT NULL COMMENT '创建时间',
    resolved DATETIME COMMENT '解决时间',
    closed DATETIME COMMENT '关闭时间',
    modified DATETIME NOT NULL COMMENT '修改时间',
    lastmodify VARCHAR(255) COMMENT '最后修改人',
    auditer VARCHAR(255) COMMENT '审核人',
    de VARCHAR(255) COMMENT '开发人员',
    te VARCHAR(255) COMMENT '测试人员',
    confirmer VARCHAR(255) COMMENT '确认人',
    current_owner VARCHAR(255) NOT NULL COMMENT '当前负责人',
    participator VARCHAR(255) COMMENT '参与者',
    closer VARCHAR(255) COMMENT '关闭人',
    status VARCHAR(50) NOT NULL COMMENT '状态（in_progress 等）',
    resolution VARCHAR(255) COMMENT '解决方式',
    priority VARCHAR(50) NOT NULL COMMENT '优先级（medium 等）',
    severity VARCHAR(50) NOT NULL COMMENT '严重程度（normal 等）',
    platform VARCHAR(255) COMMENT '平台',
    os VARCHAR(255) COMMENT '操作系统',
    testmode VARCHAR(255) COMMENT '测试模式',
    testtype VARCHAR(255) COMMENT '测试类型',
    testphase VARCHAR(255) COMMENT '测试阶段',
    source VARCHAR(255) COMMENT '来源',
    frequency VARCHAR(255) COMMENT '发生频率',
    cc VARCHAR(255) COMMENT '抄送人',
    estimate VARCHAR(255) COMMENT '预估工作量',
    flows TEXT NOT NULL COMMENT '流程状态（如 |in_progress）',
    version_report VARCHAR(255) COMMENT '报告版本',
    version_test VARCHAR(255) COMMENT '测试版本',
    version_fix VARCHAR(255) COMMENT '修复版本',
    version_close VARCHAR(255) COMMENT '关闭版本',
    delayed TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否延迟（0/1）',
    custom_field_one VARCHAR(255) COMMENT '自定义字段1',
    custom_field_two VARCHAR(255) COMMENT '自定义字段2',
    custom_field_three VARCHAR(255) COMMENT '自定义字段3',
    custom_field_four VARCHAR(255) COMMENT '自定义字段4',
    custom_field_five VARCHAR(255) COMMENT '自定义字段5',
    regression_number VARCHAR(255) COMMENT '回归次数',
    issue_id VARCHAR(255) COMMENT '关联问题ID',
    support_id VARCHAR(255) COMMENT '支持ID',
    support_forum_id VARCHAR(255) COMMENT '支持论坛ID',
    created_from VARCHAR(255) COMMENT '创建来源',
    baseline_find VARCHAR(255) COMMENT '发现基线',
    baseline_join VARCHAR(255) COMMENT '加入基线',
    baseline_close VARCHAR(255) COMMENT '关闭基线',
    ticket_id VARCHAR(255) COMMENT '工单ID',
    story_id VARCHAR(255) COMMENT '需求ID',
    baseline_test VARCHAR(255) COMMENT '测试基线',
    originphase VARCHAR(255) COMMENT '原始阶段',
    sourcephase VARCHAR(255) COMMENT '来源阶段',
    bugtype VARCHAR(255) COMMENT '缺陷类型',
    feature VARCHAR(255) COMMENT '功能点',
    in_progress_time DATETIME COMMENT '进行中时间',
    verify_time DATETIME COMMENT '验证时间',
    reject_time DATETIME COMMENT '拒绝时间',
    audit_time DATETIME COMMENT '审核时间',
    suspend_time DATETIME COMMENT '挂起时间',
    assigned_time DATETIME COMMENT '分配时间',
    iteration_id VARCHAR(36) NOT NULL DEFAULT '0' COMMENT '迭代ID（默认0）',
    custom_field_6 VARCHAR(255) COMMENT '自定义字段6',
    custom_field_7 VARCHAR(255) COMMENT '自定义字段7',
    custom_field_8 VARCHAR(255) COMMENT '自定义字段8',
    custom_plan_field_1 VARCHAR(255) NOT NULL DEFAULT '0' COMMENT '计划字段1（默认0）',
    custom_plan_field_2 VARCHAR(255) NOT NULL DEFAULT '0' COMMENT '计划字段2（默认0）',
    custom_plan_field_3 VARCHAR(255) NOT NULL DEFAULT '0' COMMENT '计划字段3（默认0）',
    custom_plan_field_4 VARCHAR(255) NOT NULL DEFAULT '0' COMMENT '计划字段4（默认0）',
    template_id VARCHAR(36) NOT NULL DEFAULT '1160498179001000029' COMMENT '模板ID',
    begin DATETIME COMMENT '开始时间',
    due DATETIME COMMENT '截止时间',
    release_id VARCHAR(36) COMMENT '发布ID',
    fixer VARCHAR(255) COMMENT '修复人',
    follower VARCHAR(255) COMMENT '关注者',
    sync_type VARCHAR(255) COMMENT '同步类型',
    label TEXT COMMENT '标签',
    effort VARCHAR(255) COMMENT '工作量',
    effort_completed VARCHAR(255) NOT NULL DEFAULT '0' COMMENT '已完成工作量（默认0）',
    exceed VARCHAR(255) NOT NULL DEFAULT '0' COMMENT '超额工作量（默认0）',
    remain VARCHAR(255) NOT NULL DEFAULT '0' COMMENT '剩余工作量（默认0）',
    progress VARCHAR(255) NOT NULL DEFAULT '0' COMMENT '进度（默认0）',
    size VARCHAR(255) COMMENT '规模',
    custom_field_101 VARCHAR(255) COMMENT '自定义字段101',
    custom_field_102 VARCHAR(255) COMMENT '自定义字段102',
    custom_field_103 VARCHAR(255) COMMENT '自定义字段103',
    custom_field_104 VARCHAR(255) COMMENT '自定义字段104',
    custom_field_105 VARCHAR(255) COMMENT '自定义字段105',
    ID VARCHAR(255) NOT NULL COMMENT '业务ID',
    is_followed VARCHAR(255) NOT NULL DEFAULT '0' COMMENT '是否关注（0/1）',
    iteration_name VARCHAR(255) COMMENT '迭代名称',
    story_name VARCHAR(255) COMMENT '需求名称',
    release_name VARCHAR(255) COMMENT '发布名称',
    template_name VARCHAR(255) NOT NULL COMMENT '模板名称',
    status_alias VARCHAR(255) NOT NULL COMMENT '状态别名',
    workspace_name VARCHAR(255) NOT NULL COMMENT '工作区名称',
    enable_quickly_transfer TINYINT(1) NOT NULL DEFAULT '0' COMMENT '是否启用快速转移（0/1）'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='缺陷信息表';



-- 插入 Bugs 表示例数据
INSERT INTO bugs (
    id, secret_root_id, sid, project_id, parent_id, title, description, markdown_description, 
    description_type, module, milestone, reporter, deadline, created, resolved, closed, 
    modified, lastmodify, auditer, de, te, confirmer, current_owner, participator, closer, 
    status, resolution, priority, severity, platform, os, testmode, testtype, testphase, 
    source, frequency, cc, estimate, flows, version_report, version_test, version_fix, 
    version_close, delayed, custom_field_one, custom_field_two, custom_field_three, 
    custom_field_four, custom_field_five, regression_number, issue_id, support_id, 
    support_forum_id, created_from, baseline_find, baseline_join, baseline_close, 
    ticket_id, story_id, baseline_test, originphase, sourcephase, bugtype, feature, 
    in_progress_time, verify_time, reject_time, audit_time, suspend_time, assigned_time, 
    iteration_id, custom_field_6, custom_field_7, custom_field_8, custom_plan_field_1, 
    custom_plan_field_2, custom_plan_field_3, custom_plan_field_4, template_id, begin, 
    due, release_id, fixer, follower, sync_type, label, effort, effort_completed, 
    exceed, remain, progress, size, custom_field_101, custom_field_102, custom_field_103, 
    custom_field_104, custom_field_105, ID, is_followed, iteration_name, story_name, 
    release_name, template_name, status_alias, workspace_name, enable_quickly_transfer
) VALUES (
    '1160498179001000009', '0', '0', '60498179', '', '【示例】缺陷2', 
    '<p>sadf&nbsp;</p><p><br /></p><p>sd&nbsp;</p><p><br /></p><p><br /></p><p>sadf</p><p><br /></p><p><br /></p><p>sdf</p><p><br /></p><p>s</p><p>df</p><p><br /></p><p><br /></p><p>sdf</p><p><br /></p><p>sd</p>', 
    '', '1', '', '', 'TAPD', '', '2025-05-30 11:17:18', '', '', 
    '2025-06-12 16:55:08', '未命名小程序', '', '未命名小程序;', '', '未命名小程序;', '', 
    'in_progress', '', 'medium', 'normal', '', '', '', '', '', '', '', '', '', '', '', 
    '|in_progress', '版本1', '', '', '', '0', '', '', '', '', '', '', '', '', '', '', 
    '0', '', '', '', '', '', '0', '', '', '', '', '', '1160498179001000029', '', '', '', 
    '', '', '', '', '', '', '0', '', '', '', '0', '0', '0', '0', '', '', '', '', '', '', 
    '1000009', '0', '', '', '', '系统默认模板', '接收/处理', '大型团队敏捷研发'
);




-- CopyInfo 表（缺陷复制链接配置）
CREATE TABLE copy_info (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    bug_id VARCHAR(36) NOT NULL COMMENT '关联缺陷ID',
    url TEXT NOT NULL COMMENT '原始缺陷详情链接',
    convert_url TEXT COMMENT '转换后链接',
    commit_keyword TEXT NOT NULL COMMENT '提交关键字模板',
    copy_id VARCHAR(255) NOT NULL COMMENT '复制ID（业务ID）',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (bug_id) REFERENCES bugs(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='缺陷复制链接配置表';





-- ShowFieldsMemo 表（缺陷显示字段配置）
CREATE TABLE show_fields_memo (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    bug_id VARCHAR(36) NOT NULL COMMENT '关联缺陷ID',
    version_report VARCHAR(255) COMMENT '版本报告字段',
    module VARCHAR(255) COMMENT '模块字段',
    priority VARCHAR(255) COMMENT '优先级字段',
    severity VARCHAR(255) COMMENT '严重程度字段',
    current_owner VARCHAR(255) COMMENT '当前负责人字段',
    reporter VARCHAR(255) COMMENT '报告人字段',
    created VARCHAR(255) COMMENT '创建时间字段',
    id_field VARCHAR(255) COMMENT 'ID字段',
    custom_field_one VARCHAR(255) COMMENT '自定义字段1',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (bug_id) REFERENCES bugs(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='缺陷显示字段配置表';




INSERT INTO copy_info (
    bug_id, url, convert_url, commit_keyword, copy_id
) VALUES (
    '1160498179001000009', 
    'https://www.tapd.cn/tapd_fe/60498179/bug/detail/1160498179001000009', 
    '', 
    '--bug=1000009 --user=未命名小程序 {#name#} https://www.tapd.cn/60498179/s/1000094', 
    '1000009'
);


INSERT INTO show_fields_memo (
    bug_id, version_report, module, priority, severity, 
    current_owner, reporter, created, id_field, custom_field_one
) VALUES (
    '1160498179001000009', 
    '', '', '', '', '', '', '', '', 'abc'
);



-- ShowFieldsConfig 表（缺陷显示字段配置）
CREATE TABLE show_fields_config (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    bug_id VARCHAR(36) NOT NULL COMMENT '关联缺陷ID',
    name VARCHAR(255) NOT NULL COMMENT '字段名称（如 version_report）',
    label VARCHAR(255) NOT NULL COMMENT '字段显示标签（如 发现版本）',
    html_type VARCHAR(50) NOT NULL COMMENT 'HTML 输入类型（select, user_chooser 等）',
    setting_url TEXT COMMENT '设置链接',
    enable_color TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否启用颜色（0/1）',
    memo TEXT COMMENT '备注信息',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (bug_id) REFERENCES bugs(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='缺陷显示字段配置表';



-- FieldColorOptions 表（字段颜色选项配置）
CREATE TABLE field_color_options (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    field_id INT NOT NULL COMMENT '关联字段ID（来自 show_fields_config.id）',
    value VARCHAR(255) NOT NULL COMMENT '选项值（如 urgent）',
    label VARCHAR(255) NOT NULL COMMENT '选项标签（如 紧急）',
    color VARCHAR(7) NOT NULL COMMENT '颜色值（如 #FF6770）',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (field_id) REFERENCES show_fields_config(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='字段颜色选项配置表';





-- 插入字段配置信息
INSERT INTO show_fields_config (
    bug_id, name, label, html_type, setting_url, enable_color, memo
) VALUES
-- version_report
('1160498179001000009', 'version_report', '发现版本', 'select', 'https://www.tapd.cn/60498179/versions', 0, ''),
-- module
('1160498179001000009', 'module', '模块', 'select', 'https://www.tapd.cn/60498179/modules/index', 0, ''),
-- priority
('1160498179001000009', 'priority', '优先级', 'select', '', 0, ''),
-- severity
('1160498179001000009', 'severity', '严重程度', 'select', '', 0, ''),
-- current_owner
('1160498179001000009', 'current_owner', '处理人', 'user_chooser', '', 0, ''),
-- reporter
('1160498179001000009', 'reporter', '创建人', 'user_chooser', '', 0, ''),
-- created
('1160498179001000009', 'created', '创建时间', 'datetime', '', 0, ''),
-- id
('1160498179001000009', 'id', 'ID', 'input', '', 0, ''),
-- custom_field_one
('1160498179001000009', 'custom_field_one', 'abc', 'text', '', 0, 'abc');




-- 插入字段颜色选项（仅对 priority 字段）
INSERT INTO field_color_options (
    field_id, value, label, color
) VALUES
-- 获取 priority 字段的 id（假设为 3）
-- 需要先查询 show_fields_config 表中 name = 'priority' 的 id
(
    (SELECT id FROM show_fields_config WHERE name = 'priority'), 
    'urgent', '紧急', '#FF6770'
),
(
    (SELECT id FROM show_fields_config WHERE name = 'priority'), 
    'high', '高', '#FF6770'
),
(
    (SELECT id FROM show_fields_config WHERE name = 'priority'), 
    'medium', '中', '#28AB80'
),
(
    (SELECT id FROM show_fields_config WHERE name = 'priority'), 
    'low', '低', '#7C8597'
),
(
    (SELECT id FROM show_fields_config WHERE name = 'priority'), 
    'insignificant', '无关紧要', '#7C8597'
);





-- EditableFieldsConfig 表（缺陷可编辑字段配置）
CREATE TABLE editable_fields_config (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    bug_id VARCHAR(36) NOT NULL COMMENT '关联缺陷ID',
    system_name VARCHAR(255) NOT NULL COMMENT '字段系统名称（如 version_report）',
    editabled_type VARCHAR(50) NOT NULL COMMENT '编辑类型（tselect, pinyinuserchooser 等）',
    required TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否必填（0/1）',
    label VARCHAR(255) COMMENT '字段显示标签（如 abc）',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (bug_id) REFERENCES bugs(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='缺陷可编辑字段配置表';





-- FieldOptions 表（字段选项配置）
CREATE TABLE field_options (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    field_id INT NOT NULL COMMENT '关联字段ID（来自 editable_fields_config.id）',
    value TEXT NOT NULL COMMENT '选项值（如 版本1）',
    label TEXT NOT NULL COMMENT '选项标签（如 模块1）',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (field_id) REFERENCES editable_fields_config(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='字段选项配置表';


-- FieldColorOptions 表（字段颜色选项配置）
CREATE TABLE field_color_options (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    field_id INT NOT NULL COMMENT '关联字段ID（来自 editable_fields_config.id）',
    value VARCHAR(255) NOT NULL COMMENT '选项值（如 urgent）',
    label VARCHAR(255) NOT NULL COMMENT '选项标签（如 紧急）',
    color VARCHAR(7) NOT NULL COMMENT '颜色值（如 #FF6770）',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (field_id) REFERENCES editable_fields_config(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='字段颜色选项配置表';




-- FieldDataSources 表（字段数据源配置）
CREATE TABLE field_data_sources (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    field_id INT NOT NULL COMMENT '关联字段ID（来自 editable_fields_config.id）',
    data_source_url TEXT NOT NULL COMMENT '数据源URL（如 https://www.tapd.cn/）',
    data_source_params TEXT NOT NULL COMMENT '数据源参数（如 ?workspace_id=60498179&r=3）',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (field_id) REFERENCES editable_fields_config(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='字段数据源配置表';


-- 插入可编辑字段配置
INSERT INTO editable_fields_config (
    bug_id, system_name, editabled_type, required, label
) VALUES
-- version_report
('1160498179001000009', 'version_report', 'tselect', 0, NULL),
-- module
('1160498179001000009', 'module', 'tselect', 0, NULL),
-- priority
('1160498179001000009', 'priority', 'tselect', 0, NULL),
-- severity
('1160498179001000009', 'severity', 'tselect', 0, NULL),
-- current_owner
('1160498179001000009', 'current_owner', 'pinyinuserchooser', 0, NULL),
-- custom_field_one
('1160498179001000009', 'custom_field_one', 'text', 0, 'abc');



-- 插入字段选项（version_report, module, severity）
INSERT INTO field_options (
    field_id, value, label
) VALUES
-- version_report
((SELECT id FROM editable_fields_config WHERE system_name = 'version_report'), '版本1', '版本1'),
-- module
((SELECT id FROM editable_fields_config WHERE system_name = 'module'), '模块1', '模块1'),
-- severity
((SELECT id FROM editable_fields_config WHERE system_name = 'severity'), '致命', '致命'),
((SELECT id FROM editable_fields_config WHERE system_name = 'severity'), '严重', '严重'),
((SELECT id FROM editable_fields_config WHERE system_name = 'severity'), '一般', '一般'),
((SELECT id FROM editable_fields_config WHERE system_name = 'severity'), '提示', '提示'),
((SELECT id FROM editable_fields_config WHERE system_name = 'severity'), '建议', '建议');




-- 插入字段颜色选项（priority）
INSERT INTO field_color_options (
    field_id, value, label, color
) VALUES
((SELECT id FROM editable_fields_config WHERE system_name = 'priority'), 'urgent', '紧急', '#FF6770'),
((SELECT id FROM editable_fields_config WHERE system_name = 'priority'), 'high', '高', '#FF6770'),
((SELECT id FROM editable_fields_config WHERE system_name = 'priority'), 'medium', '中', '#28AB80'),
((SELECT id FROM editable_fields_config WHERE system_name = 'priority'), 'low', '低', '#7C8597'),
((SELECT id FROM editable_fields_config WHERE system_name = 'priority'), 'insignificant', '无关紧要', '#7C8597');


-- 插入字段数据源（current_owner）
INSERT INTO field_data_sources (
    field_id, data_source_url, data_source_params
) VALUES
((SELECT id FROM editable_fields_config WHERE system_name = 'current_owner'), 
 'https://www.tapd.cn/', 
 '?workspace_id=60498179&r=3');





-- BugSocketConnection 表（缺陷实时通信配置）
CREATE TABLE bug_socket_connection (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    bug_id VARCHAR(36) NOT NULL COMMENT '关联缺陷ID',
    socket_path TEXT NOT NULL COMMENT 'WebSocket 连接路径',
    user_nick VARCHAR(255) NOT NULL COMMENT '用户昵称',
    workspace_id VARCHAR(36) NOT NULL COMMENT '工作空间ID',
    timespan DECIMAL(20, 6) NOT NULL COMMENT '时间戳（秒级精度）',
    data_id VARCHAR(255) NOT NULL COMMENT '数据标识（如 workitems）',
    token VARCHAR(255) NOT NULL COMMENT '访问令牌',
    room_id VARCHAR(255) NOT NULL COMMENT 'WebSocket 房间ID',
    socket_id VARCHAR(36) NOT NULL COMMENT 'Socket ID',
    need_disconnect TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否需要断开连接（0/1）',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (bug_id) REFERENCES bugs(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='缺陷实时通信配置表';



-- BugComments 表（缺陷评论）
CREATE TABLE bug_comments (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    bug_id VARCHAR(36) NOT NULL COMMENT '关联缺陷ID',
    comment_text TEXT COMMENT '评论内容',
    created_by VARCHAR(255) NOT NULL COMMENT '评论人',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '评论时间',
    FOREIGN KEY (bug_id) REFERENCES bugs(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='缺陷评论表';


-- BugAttachments 表（缺陷附件）
CREATE TABLE bug_attachments (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    bug_id VARCHAR(36) NOT NULL COMMENT '关联缺陷ID',
    filename VARCHAR(255) NOT NULL COMMENT '文件名',
    file_type VARCHAR(50) NOT NULL COMMENT '文件类型（如 docx, png）',
    file_size BIGINT NOT NULL COMMENT '文件大小（字节）',
    previewable TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否可预览（0/1）',
    download_allowed TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否允许下载（0/1）',
    delete_allowed TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否允许删除（0/1）',
    edit_allowed TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否允许编辑（0/1）',
    upload_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '上传时间',
    FOREIGN KEY (bug_id) REFERENCES bugs(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='缺陷附件表';



-- BugAttachmentPermissions 表（附件权限配置）
CREATE TABLE bug_attachment_permissions (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    workspace_id VARCHAR(36) NOT NULL COMMENT '工作空间ID',
    is_enabled_document TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否启用文档功能（0/1）',
    download_allowed TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否允许下载（0/1）',
    delete_allowed TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否允许删除（0/1）',
    edit_allowed TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否允许编辑（0/1）',
    document_download_allowed TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否允许下载文档（0/1）',
    view_document_allowed TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否允许查看文档（0/1）',
    edit_document_allowed TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否允许编辑文档（0/1）',
    delete_document_allowed TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否允许删除文档（0/1）',
    can_export_mindmap_pic TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否允许导出思维导图（0/1）',
    max_file_upload_size BIGINT NOT NULL COMMENT '最大文件上传大小（字节）',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='附件权限配置表';



-- 插入缺陷实时通信配置
INSERT INTO bug_socket_connection (
    bug_id, socket_path, user_nick, workspace_id, timespan, data_id, token, room_id, socket_id, need_disconnect
) VALUES (
    '1160498179001000009',
    'https://spider.tapd.cn/workitems',
    '未命名小程序::328519613',
    '60498179',
    1749718574.9494866,
    'workitems',
    'c1ea348e500cd3f0b6197e7a74adbd9848adc681',
    'WORKITEMS_CHANGE_bug_detail_1160498179001000009',
    '60498179',
    1
);


-- 插入缺陷评论（当前无评论数据）
-- 示例：若存在评论，可按以下格式插入
-- INSERT INTO bug_comments (bug_id, comment_text, created_by, created_at) VALUES ('1160498179001000009', '测试评论', 'admin', NOW());


-- 插入缺陷附件（当前无附件数据）
-- 示例：若存在附件，可按以下格式插入
-- INSERT INTO bug_attachments (bug_id, filename, file_type, file_size, previewable, download_allowed, delete_allowed, edit_allowed) VALUES ('1160498179001000009', 'test.png', 'png', 1024, 1, 1, 0, 1);



-- 插入附件权限配置
INSERT INTO bug_attachment_permissions (
    workspace_id, is_enabled_document, download_allowed, delete_allowed, edit_allowed,
    document_download_allowed, view_document_allowed, edit_document_allowed, delete_document_allowed,
    can_export_mindmap_pic, max_file_upload_size
) VALUES (
    '60498179',
    1, 1, 1, 1,
    1, 1, 1, 1,
    0, 157286400
);


























